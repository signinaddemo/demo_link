<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>content-gallery h5 template</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/TweenMax.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/plugins/PixiPlugin.min.js"></script>
  <style>
    * { margin: 0; }

    #ad-wrapper {
      width: 100%;
      height: calc(100vw * 0.5625);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: row-reverse;
    }

    #video-wrapper {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 30%;
      cursor: pointer;
    }

    #video { width: 100%; height: 100%; object-fit: cover; }

    #img-wrapper { cursor: pointer; width: 30%; }

    #img { object-fit: cover; height: 100%; width: 100%; }

    #image2-wrapper {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%
    }

    #image2-wrapper img { object-fit: cover; height: 100%; width: 100%; }

    #banner {
      position: absolute;
      top: 0; left: 0;
      width: 70%; height: 100%;
      overflow: hidden;
    }
  </style>

  <!-- 覆寫(只為避免展開後重疊；其餘維持) -->
  <style>
    /* 展開時，改成直向堆疊 */
    #ad-wrapper.opened {
      flex-direction: column;
      height: auto;
      align-items: stretch;
    }
    #ad-wrapper.opened #img-wrapper { width: 100%; }
    #ad-wrapper.opened #banner     { width: 100%; }

    /* 讓 banner 回到正常文流（非 absolute），避免覆蓋 */
    #ad-wrapper.opened #banner {
      position: relative !important;
      top: auto !important; left: auto !important;
      height: auto; overflow: hidden;
      transition: height 0.8s;
    }
    #ad-wrapper.opened #image2-wrapper {
      position: relative !important;
      width: 100%; height: auto !important;
    }
    #ad-wrapper.opened #image2-wrapper img {
      width: 100%; height: auto !important;
      object-fit: contain; display: block;
    }
  </style>
</head>

<body>
  <img src="./images/background0.png" style="width: 100vw;" />
  <img src="./images/background1.png" style="width: 100vw;" />

  <div id="ad-wrapper" onclick="openUrl()">
    <!-- 上方 640x600 -->
    <div id="img-wrapper">
      <div style="width: 100%; display: flex; justify-content: center; position: relative;">
        <img src="./images/828/640x600.jpg" alt="" id="video" />
        <!-- 保留你的註解區 -->
      </div>
    </div>

    <!-- 下方 640x360 -->
    <div id="banner" class="swiper-wrapper">
      <div id="image2-wrapper">
        <img src="./images/828/640x360.jpg"/>
      </div>
    </div>
  </div>

  <img src="./images/background2.png" style="width: 100vw;" />
</body>

<script>
  const video = document.getElementById('video');
  const adWrapper = document.getElementById('ad-wrapper');
  const adVideoWrapper = document.getElementById('video-wrapper');
  const adVideo = document.getElementById('video');
  const adImageWrapper = document.getElementById('img-wrapper');
  const adBanner = document.getElementById('banner');
  const adImage2Wrapper = document.getElementById('image2-wrapper');
</script>

<script>
  function delay (s) {
    return new Promise(function (resolve) { setTimeout(resolve, s); });
  }

  function openUrl() {
    window.open('https://www.boucheron.com/tw/');
  }

  function openAd() {
    const slot = adVideoWrapper ? adVideoWrapper : adImageWrapper;
    const topWrapperHeight = adVideoWrapper ? adVideoWrapper.clientHeight : adImageWrapper.clientHeight;

    // === 原有動畫屬性保留（transition） ===
    slot.style.transition = 'width 0.8s';
    adBanner.style.transition = 'all 0.8s';

    // === 最小更動：改成直向堆疊並把 banner 放回文流 ===
    adWrapper.classList.add('opened');
    slot.style.width = '100%';

    // 清除原本用來疊放的位置控制，避免覆蓋
    adWrapper.style.paddingBottom = '0px';
    adBanner.style.top = 'auto';
    adBanner.style.left = 'auto';

    // 以 16:9 計算展開高度，避免高度為 0
    const w = adBanner.clientWidth || adImage2Wrapper.clientWidth || adWrapper.clientWidth;
    const openHeight = Math.round(w * (360 / 640));
    adBanner.style.height = openHeight + 'px';
  }
</script>

<script>
  let isOpened = false;

  window.addEventListener('scroll', () => {
    const videoHeight = video.getBoundingClientRect().height;
    const topValue = video.getBoundingClientRect().y;
    const screenH = window.screen.height;

    if (!isOpened) {
      if (topValue < screenH - videoHeight) {
        openAd();
        isOpened = true;
      }
    }
  });
</script>
</html>
